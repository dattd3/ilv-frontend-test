{"version":3,"file":"index.es.js","sources":["../src/html-flip-book/index.tsx"],"sourcesContent":["import React, {\r\n    ReactElement,\r\n    useCallback,\r\n    useEffect,\r\n    useImperativeHandle,\r\n    useRef,\r\n    useState,\r\n} from 'react';\r\n\r\nimport { PageFlip } from \"@cuongnv56/page-flip\";\r\nimport { IFlipSetting, IEventProps } from './settings';\r\n\r\ninterface IProps extends IFlipSetting, IEventProps {\r\n    className: string;\r\n    style: React.CSSProperties;\r\n    children: React.ReactNode;\r\n    renderOnlyPageLengthChange?: boolean;\r\n}\r\n\r\nconst HTMLFlipBookForward = React.forwardRef(\r\n    (props: IProps, ref: React.MutableRefObject<PageFlip>) => {\r\n        const htmlElementRef = useRef<HTMLDivElement>(null);\r\n        const childRef = useRef<HTMLElement[]>([]);\r\n        const pageFlip = useRef<PageFlip>();\r\n\r\n        const [pages, setPages] = useState<ReactElement[]>([]);\r\n\r\n        useImperativeHandle(ref, () => ({\r\n            pageFlip: () => pageFlip.current,\r\n        }));\r\n\r\n        const refreshOnPageDelete = useCallback(() => {\r\n            if (pageFlip.current) {\r\n                pageFlip.current.clear();\r\n            }\r\n        }, []);\r\n\r\n        const removeHandlers = useCallback(() => {\r\n            const flip = pageFlip.current;\r\n\r\n            if (flip) {\r\n                flip.off('flip');\r\n                flip.off('changeOrientation');\r\n                flip.off('changeState');\r\n                flip.off('init');\r\n                flip.off('update');\r\n            }\r\n        }, []);\r\n\r\n        useEffect(() => {\r\n            childRef.current = [];\r\n\r\n            if (props.children) {\r\n                const childList = React.Children.map(props.children, (child) => {\r\n                    return React.cloneElement(child as ReactElement, {\r\n                        ref: (dom) => {\r\n                            if (dom) {\r\n                                childRef.current.push(dom);\r\n                            }\r\n                        },\r\n                    });\r\n                });\r\n\r\n                if (!props.renderOnlyPageLengthChange || pages.length !== childList.length) {\r\n                    if (childList.length < pages.length) {\r\n                        refreshOnPageDelete();\r\n                    }\r\n\r\n                    setPages(childList);\r\n                }\r\n            }\r\n            // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        }, [props.children]);\r\n\r\n        useEffect(() => {\r\n            const setHandlers = () => {\r\n                const flip = pageFlip.current;\r\n\r\n                if (flip) {\r\n                    if (props.onFlip) {\r\n                        flip.on('flip', (e: unknown) => props.onFlip(e));\r\n                    }\r\n\r\n                    if (props.onChangeOrientation) {\r\n                        flip.on('changeOrientation', (e: unknown) => props.onChangeOrientation(e));\r\n                    }\r\n\r\n                    if (props.onChangeState) {\r\n                        flip.on('changeState', (e: unknown) => props.onChangeState(e));\r\n                    }\r\n\r\n                    if (props.onInit) {\r\n                        flip.on('init', (e: unknown) => props.onInit(e));\r\n                    }\r\n\r\n                    if (props.onUpdate) {\r\n                        flip.on('update', (e: unknown) => props.onUpdate(e));\r\n                    }\r\n                }\r\n            };\r\n\r\n            if (pages.length > 0 && childRef.current.length > 0) {\r\n                removeHandlers();\r\n\r\n                if (htmlElementRef.current && !pageFlip.current) {\r\n                    pageFlip.current = new PageFlip(htmlElementRef.current, props);\r\n                }\r\n\r\n                if (!pageFlip.current.getFlipController()) {\r\n                    pageFlip.current.loadFromHTML(childRef.current);\r\n                } else {\r\n                    pageFlip.current.updateFromHtml(childRef.current);\r\n                }\r\n\r\n                setHandlers();\r\n            }\r\n            // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        }, [pages]);\r\n\r\n        return (\r\n            <div ref={htmlElementRef} className={props.className} style={props.style}>\r\n                {pages}\r\n            </div>\r\n        );\r\n    }\r\n);\r\n\r\nexport const HTMLFlipBook = React.memo(HTMLFlipBookForward);\r\n"],"names":[],"mappings":"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"}